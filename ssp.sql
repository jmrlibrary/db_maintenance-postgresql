
-- ="('" & A2 & "', " & B2 & ", " & C2 & "," & D2 & ", '" & E2 & "'), "
-- ('9780471679912', 1, 1,64, 'Green'), 

drop  table  if exists  ssp;
create temp table ssp (
	jmrl_id	int,
	jmrl_list_id text,
	identifier text,
	quant int,
	jmrl_packing_id int);
insert into ssp values 
(134, 'A2', '1560540001', 1, 007), 
(135, 'A2', '0896211819', 1, 007), 
(136, 'A2', '0816147159', 1, 007), 
(137, 'A2', '0896217086', 1, 007), 
(138, 'A2', '0816146993', 1, 007), 
(139, 'A2', '0896219933', 1, 007), 
(140, 'A2', '9780060185145', 1, 007), 
(141, 'A2', '9780312205638', 1, 007), 
(142, 'A2', '9780312266790', 1, 007), 
(143, 'A2', '9780375413223', 1, 007), 
(144, 'A2', '9780399154362', 1, 007), 
(145, 'A2', '9780609605479', 1, 007), 
(146, 'A2', '9780684845784', 1, 007), 
(147, 'A2', '9780743233460', 1, 007), 
(148, 'A2', '9780786703111', 1, 007), 
(149, 'A2', '9780786860685', 1, 007), 
(150, 'A2', '9780802718006', 1, 007), 
(151, 'A2', '9780802733757', 1, 007), 
(152, 'A2', '9780783883236', 1, 007), 
(153, 'A2', '9780753199473', 1, 007), 
(154, 'A2', '9780739328323', 1, 007), 
(155, 'A2', '9781594133138', 1, 007), 
(156, 'A2', '9780375435058', 1, 007), 
(157, 'A2', '9780786207237', 1, 007), 
(158, 'A2', '9781568954424', 1, 007), 
(159, 'A2', '0816136270', 1, 008), 
(160, 'A2', '0816133824', 1, 008), 
(161, 'A2', '0151551421', 1, 008), 
(162, 'A2', '1850892865', 1, 008), 
(163, 'A2', '081613913x', 1, 008), 
(164, 'A2', '1850896055', 1, 008), 
(165, 'A2', '0816136075', 1, 008), 
(166, 'A2', '0708967523', 1, 008), 
(167, 'A2', '0816140081', 1, 008), 
(168, 'A2', '1560543132', 1, 008), 
(169, 'A2', '9780786208159', 1, 008), 
(170, 'A2', '9780786298914', 1, 008), 
(171, 'A2', '9781568957647', 1, 008), 
(172, 'A2', '9780816174294', 1, 008), 
(173, 'A2', '9780816158904', 1, 008), 
(174, 'A2', '9780679738138', 1, 008), 
(175, 'A2', '9781476746586', 1, 008), 
(176, 'A2', '9780517595657', 1, 008), 
(177, 'A2', '9780786221646', 1, 008), 
(178, 'A2', '9780786215065', 1, 008), 
(179, 'A2', '9781594139390', 1, 008), 
(180, 'A2', '9780804120906', 1, 008), 
(181, 'A2', '9781455545346', 1, 008), 
(182, 'A2', '9781410405708', 1, 008), 
(183, 'A2', '9780786214327', 1, 008), 
(184, 'A2', '9781432859688', 1, 008), 
(185, 'A2', '9780783882857', 1, 008), 
(186, 'A2', '9780786200764', 1, 008), 
(187, 'A2', '9781410424235', 1, 008), 
(188, 'A2', '9780786236473', 1, 008), 
(189, 'A2', '9780786289875', 1, 008), 
(190, 'A2', '9781410404459', 1, 008), 
(191, 'A2', '9781568953038', 1, 008), 
(192, 'A2', '9780061945731', 1, 008), 
(193, 'A2', '0816165378', 1, 009), 
(194, 'A2', '1560547227', 1, 009), 
(195, 'A2', '0816156085', 1, 009), 
(196, 'A2', '0786219076', 1, 009), 
(197, 'A2', '0816140049', 1, 009), 
(198, 'A2', '1555047017', 1, 009), 
(199, 'A2', '9780375431852', 1, 009), 
(200, 'A2', '9781594136481', 1, 009), 
(201, 'A2', '9781568952123', 1, 009), 
(202, 'A2', '9780786264650', 1, 009), 
(203, 'A2', '9780786232321', 1, 009), 
(204, 'A2', '9781594133183', 1, 009), 
(205, 'A2', '9781594130465', 1, 009), 
(206, 'A2', '9780786220014', 1, 009), 
(207, 'A2', '9781410431899', 1, 009), 
(208, 'A2', '9780786215263', 1, 009), 
(209, 'A2', '9781410465023', 1, 009), 
(210, 'A2', '9780786292868', 1, 009), 
(211, 'A2', '9781410440877', 1, 009), 
(212, 'A2', '9780446517591', 1, 009), 
(213, 'A2', '9780783887302', 1, 009), 
(214, 'A2', '9780783895574', 1, 009), 
(215, 'A2', '9780783816760', 1, 009), 
(216, 'A2', '9780783818283', 1, 009), 
(217, 'A2', '9780783884431', 1, 009), 
(218, 'A2', '9780783894911', 1, 009), 
(219, 'A2', '9780783895406', 1, 009), 
(220, 'A2', '9781410494436', 1, 009), 
(221, 'A2', '9780783887241', 1, 009), 
(222, 'A2', '9780783804354', 1, 009), 
(223, 'A2', '9781455513550', 1, 009), 
(224, 'A2', '9780446553933', 1, 009), 
(225, 'A2', '9780783893518', 1, 009), 
(226, 'A2', '9780783814667', 1, 010), 
(227, 'A2', '9780783883960', 1, 010), 
(228, 'A2', '9780374299385', 1, 010), 
(229, 'A2', '9780071464666', 1, 010), 
(230, 'A2', '9780783883816', 1, 010), 
(231, 'A2', '9781615640126', 1, 010), 
(232, 'A2', '9781592579808', 1, 010), 
(233, 'A2', '9781568952109', 1, 010), 
(234, 'A2', '9781439197035', 1, 010), 
(235, 'A2', '9780783819303', 1, 010), 
(236, 'A2', '9780062644152', 1, 010), 
(237, 'A2', '9781602851610', 1, 010), 
(238, 'A2', '9780783887258', 1, 010), 
(239, 'A2', '9780062656353', 1, 010), 
(240, 'A2', '9780786220076', 1, 010), 
(241, 'A2', '9781250200761', 1, 010), 
(242, 'A2', '9781591860488', 1, 010), 
(243, 'A2', '9781400067930', 1, 010), 
(244, 'A2', '9780783818436', 1, 010), 
(245, 'A2', '9780783888088', 1, 010), 
(246, 'A2', '9781568955131', 1, 010), 
(247, 'A2', '9780783892771', 1, 010), 
(248, 'A2', '9780786214433', 1, 010), 
(249, 'A2', '9781410414281', 1, 010), 
(250, 'A2', '9780786249077', 1, 010), 
(251, 'A2', '9780786298433', 1, 010), 
(252, 'A2', '9780684187501', 1, 010), 
(253, 'A2', '9780783801377', 1, 010), 
(254, 'A2', '9781568954929', 1, 010), 
(255, 'A2', '9780786255962', 1, 010), 
(256, 'A2', '9780783887289', 1, 010), 
(257, 'A2', '9780786222865', 1, 010), 
(258, 'A2', '9780786207923', 1, 010), 
(259, 'A2', '9781585479566', 1, 010), 
(260, 'A2', '9781585476039', 1, 010), 
(261, 'A2', '9780786219032', 1, 010), 
(262, 'A2', '9780316224239', 1, 011), 
(263, 'A2', '9780786278107', 1, 011), 
(264, 'A2', '9780786271238', 1, 011), 
(265, 'A2', '9780393037081', 1, 011), 
(266, 'A2', '9780399155147', 1, 011), 
(267, 'A2', '9780316693707', 1, 011), 
(268, 'A2', '9781455512355', 1, 011), 
(269, 'A2', '9780449908488', 1, 011), 
(270, 'A2', '9780312082079', 1, 011), 
(271, 'A2', '9780312083205', 1, 011), 
(272, 'A2', '9780892960224', 1, 011), 
(273, 'A2', '9781565125766', 1, 011), 
(274, 'A2', '9781616200763', 1, 011), 
(275, 'A2', '9781579623197', 1, 011), 
(276, 'A2', '9780061655500', 1, 011), 
(277, 'A2', '9780316018746', 1, 011), 
(278, 'A2', '9780316710602', 1, 011), 
(279, 'A2', '9780684193809', 1, 011), 
(280, 'A2', '9780399143670', 1, 011), 
(281, 'A2', '9781556114977', 1, 012), 
(282, 'A2', '9780741423085', 1, 012), 
(283, 'A2', '9781250027658', 1, 012), 
(284, 'A2', '9780805080988', 1, 012), 
(285, 'A2', '9780553803495', 1, 012), 
(286, 'A2', '9781579622220', 1, 012), 
(287, 'A2', '9781453234808', 1, 012), 
(288, 'A2', '9780786210930', 1, 012), 
(289, 'A2', '9781410447289', 1, 012), 
(290, 'A2', '9781410475206', 1, 012), 
(291, 'A2', '9780786213740', 1, 012), 
(292, 'A2', '9780786273195', 1, 012), 
(293, 'A2', '9780786214853', 1, 012), 
(294, 'A2', '9781568956022', 1, 012), 
(295, 'A2', '9780786217984', 1, 012), 
(296, 'A2', '9781410450760', 1, 012), 
(297, 'A2', '9780804194723', 1, 012), 
(298, 'A2', '9780816154005', 1, 012), 
(299, 'A2', '9780786231614', 1, 012), 
(300, 'A2', '9780783894713', 1, 012), 
(301, 'A2', '9780316422734', 1, 012), 
(302, 'A2', '1555046495', 1, 013), 
(303, 'A2', '0871315718', 1, 013), 
(304, 'A2', '0816141436', 1, 013), 
(305, 'A2', '0745110177', 1, 013), 
(306, 'A2', '0896216624', 1, 013), 
(307, 'A2', '0816151946', 1, 013), 
(308, 'A2', '9780783803340', 1, 013), 
(309, 'A2', '9780786206117', 1, 013), 
(310, 'A2', '9780786224432', 1, 013), 
(311, 'A2', '9780739378090', 1, 013), 
(312, 'A2', '9780783883779', 1, 013), 
(313, 'A2', '9780816157969', 1, 013), 
(314, 'A2', '9780783894096', 1, 013), 
(315, 'A2', '9780783819518', 1, 013), 
(316, 'A2', '9781432840068', 1, 013), 
(317, 'A2', '9780783892764', 1, 013), 
(318, 'A2', '9781568954622', 1, 013), 
(319, 'A2', '9781568954837', 1, 013), 
(320, 'A2', '9780786207657', 1, 013), 
(321, 'A2', '9781568955698', 1, 013), 
(322, 'A2', '9780786207183', 1, 013), 
(323, 'A2', '9780816148592', 1, 013), 
(324, 'A2', '9781568956817', 1, 013), 
(325, 'A2', '9780783889399', 1, 013), 
(326, 'A2', '9781410405890', 1, 013), 
(327, 'A2', '9780786288854', 1, 013), 
(328, 'A2', '9780783893549', 1, 013), 
(329, 'A2', '9781568953359', 1, 013), 
(330, 'A2', '9780783896397', 1, 013), 
(331, 'A2', '9780739328279', 1, 013), 
(332, 'A2', '9781410443014', 1, 013), 
(333, 'A2', '9780786239245', 1, 013), 
(334, 'A2', '9781585474615', 1, 013), 
(335, 'A2', '9781585475162', 1, 013), 
(336, 'A2', '9781568954295', 1, 013), 
(337, 'A2', '9780786292059', 1, 013), 
(338, 'A2', '9780786209484', 1, 013), 
(339, 'A2', '9780786229437', 1, 013), 
(340, 'A2', '9780786212859', 1, 013);


with 
	ssp_full as (

	SELECT
	
		ssp.*, 
		id2reckey(e.record_id) as reckey,
		e.record_id as record_id
	FROM
		ssp
	left join
		sierra_view.phrase_entry  e
		on
		--	e.index_tag || e.index_entry = 'i' || ssp.identifier
	e.index_tag = 'i'
		and e.index_entry ilike (ssp.identifier || '%')


)
select 
	distinct 
		s.*, 
		b.best_title,	
		b.best_author,
		b.reckey,
		b.bib_record_id,
		b.material_code,
		b.publish_year
	
	from 
		ssp_full s 
	left join 
		sierra_view.bib_record_property b 
		on s.record_id = b.bib_record_id 
	
	order by jmrl_id;